# Quiz Publishing Module

This module adds the ability to publish quizzes generated by the AP Lang Quiz Generator to an external database through an API.

## Features

- Save generated quizzes to JSON files
- Publish quizzes to the InceptStore database
- Interactive CLI for publishing quizzes
- Support for creating new courses with quizzes
- Support for adding quizzes to existing courses as new modules
- Support for updating existing modules in existing courses
- Standalone API for integration with other systems

## Configuration

To use the publishing functionality, you can configure the following optional settings:

1. Optional configuration in `.env` file:
   - `INCEPTSTORE_API_URL`: API endpoint (defaults to "https://coreapi.inceptstore.com/case/publish")
   - `OUTPUT_DIR`: Directory for saving generated quizzes (defaults to "generated_quizzes")

## Usage

### Command-line Usage

To generate and publish a quiz:

```bash
python cli.py --lesson "Lesson Name" --difficulty 2 --num-questions 8 --publish
```

To publish an existing quiz file:

```bash
python cli.py --publish-only path/to/quiz.json
```

#### Creating a New Course

To automatically create a new course when publishing:

```bash
python cli.py --lesson "Lesson Name" --publish --new-course --module-name "Module Name" --item-name "Quiz Name" --xp-value 25
```

#### Adding to an Existing Course

To add a quiz as a new module to an existing course:

```bash
python cli.py --lesson "Lesson Name" --publish --existing-course "course_id_123" --module-name "New Module" --item-name "New Quiz" --xp-value 20
```

#### Updating an Existing Module

To update an existing module in an existing course:

```bash
python cli.py --lesson "Lesson Name" --publish --update-module "course_id_123:module_id_456" --item-name "Updated Quiz" --xp-value 20
```

### Publishing Options

When publishing interactively, you will be asked:

1. Whether you want to publish the quiz to the database (yes/no)
2. Whether you want to create a new course, add to an existing course, or update an existing module (new/add/update)
3. If creating a new course:
   - Course title
   - Module name
   - Item name
   - XP value
4. If adding to an existing course:
   - Course ID
   - New module name
   - Quiz name
   - XP value
5. If updating an existing module:
   - Course ID
   - Module ID
   - Quiz name
   - XP value

### API Usage

You can use the `PublishQuestions` class in your own code:

```python
from publish_questions import PublishQuestions
import asyncio

async def publish_my_quiz(quiz_data):
    publisher = PublishQuestions()
    result = await publisher.process_quiz(quiz_data)
    return result

# Run the async function
result = asyncio.run(publish_my_quiz(quiz_data))
```

## API Payload Format

### For Creating a New Course

```json
{
  "content": [
    {
      "content": [
        {
          "material": "[question text]",
          "referenceText": "[passage text]",
          "explanation": "[explanation text]",
          "responses": [
            {"label": "[correct answer text]", "isCorrect": true},
            {"label": "[distractor1 text]", "isCorrect": false},
            {"label": "[distractor2 text]", "isCorrect": false},
            {"label": "[distractor3 text]", "isCorrect": false}
          ],
          "difficulty": 1
        },
        // More questions...
      ],
      "content_type": "Question"
    }
  ],
  "course_details": {
    "course": {"title": "[course title]"},
    "module": {"name": "[module name]"},
    "items": [
      {
        "name": "[item name]",
        "contentType": "quiz",
        "xp": 10
      }
    ]
  }
}
```

### For Adding to an Existing Course

```json
{
  "content": [
    {
      "content": [
        // Questions formatted the same as above
      ],
      "content_type": "Question"
    }
  ],
  "course_details": {
    "module": {"name": "[module name]"},
    "items": [
      {
        "name": "[item name]",
        "contentType": "quiz",
        "xp": 10
      }
    ],
    "course_id": "[course_id]"
  }
}
```

### For Updating an Existing Module

```json
{
  "content": [
    {
      "content": [
        // Questions formatted the same as above
      ],
      "content_type": "Question"
    }
  ],
  "course_details": {
    "items": [
      {
        "name": "[item name]",
        "contentType": "quiz",
        "xp": 10
      }
    ],
    "course_id": "[course_id]",
    "module_id": "[module_id]"
  }
}
```

## Future Enhancements

- Integration with course management systems
- Batch publishing of multiple quizzes
- Advanced configuration options for course creation
- Support for fetching and displaying available courses and modules

## Troubleshooting

- If publishing fails, check your internet connection
- Look for detailed error information in the log file
- Ensure the API endpoint is accessible from your network
- Verify that your quiz data has the expected structure 